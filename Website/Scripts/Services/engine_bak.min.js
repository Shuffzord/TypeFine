var engine=angular.module("engineModule",[]);engine.controller("searchController",["$scope","$timeout","$http","$sce","$q",function(n,t,i,r,u){function o(n){return n===null||n.match(/^ *$/)!==null}function s(){(f.resolve(),f=u.defer(),n.isAnyWordInSearch())&&(n.loading=!0,i.get(h,{timeout:f.promise,params:{value:n.searchBox,skip:!!n.page}}).success(function(t){if(n.loading=!1,t.Success){if(t.Phrases==null||!t.Phrases.length){n.items=[];n.noResults=!0;return}if(n.page||(n.items=[]),t.Keyword!=n.searchBox){n.items=[];return}n.noResults=!1;var i=[];angular.forEach(t.Phrases,function(n){this.push({keyword:n.Keyword,comment:n.Comment,title:n.Right})},i);n.items=i;n.loading=!1}}).error(function(){n.items=[];n.loading=!1}))}var h=ViewBag.q,c=ViewBag.m,f,e;n.to_trusted=function(n){return r.trustAsHtml(n)};n.items=[];n.matchedIndex=-1;n.searchBox=ViewBag.query;n.more=!1;n.page=0;n.isAnyWordInSearch=function(){var t=n.searchBox;return!o(t)};f=u.defer();n.triggerSearch=function(){n.page=0;s()};n.loadMore=function(){n.page=1;s()};n.triggerMatch=function(t,r,u){n.matchedIndex>0||(n.matchedIndex=u,i.get(c,{params:{keyword:t,phrase:r}}))};n.loading=!1;n.$watch("searchBox",function(t){if(!t){n.items=[];n.loading=!1;return}});n.$watch("searchBox",function(i){if(e&&t.cancel(e),!i||o(i)){n.items=[];n.loading=!1;return}e=t(function(){n.triggerSearch()},300)});n.$watchCollection("items",function(t){if(n.matchedIndex=-1,n.page>0){n.more=!1;return}t.length<6&&t.length>0&&(n.more=!0);(t.length==0||t.length>5)&&(n.more=!1)})}]);